<html>
	<head>
    <script src="//code.jquery.com/jquery-1.12.0.min.js"></script>

	</head>
  <body onload="checkTokenGrant()">
    <script language="javaScript">
      var clientId='test.endpoint.client';
      var clientSecret='';
      var clientAuth=btoa(clientId+':'+clientSecret);
      //var idpHost='http://localhost:8080';
      var idpHost='https://if-idp.appspot.com';
      var idpLogin=idpHost+'/oauth/authorize?client_id='+clientId+'&response_type=token&redirect_uri='+'http://'+window.location.hostname+window.location.pathname;
      function login(){
        window.location=idpLogin;
      }
      function logout(){
      	window.sessionStorage.idpAuth=null;
      	goHome();
      }
      function goHome() {
      	window.location='http://'+window.location.hostname+window.location.pathname;
      }
      function startup() {
      	if (window.sessionStorage.idpAuth) {
      		$("#main").html("Welcome " + data['given_name'] + " " + data['family_name']);
			$("#action").html('<a href="javascript:logout();">Logout</a>');
      	} else {
			$("#main").html("Welcome Guest");
			$("#action").html('<a href="javascript:login();">Login</a>');
			checkTokenGrant();
      	}
      }
      function checkTokenGrant() {
      	// First, parse the query string
		var params = {}, queryString = location.hash.substring(1),
		    regex = /([^&=]+)=([^&]*)/g, m;
		while (m = regex.exec(queryString)) {
		  params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
		}

		// Verify that we have a token grant
		if (params['access_token']) {
			// validate the token
			$.ajax({
				url:idpHost+'/oauth/check_token',
				type: "POST",
				headers: {
					Authorization: "Basic " + clientAuth
				},
				data: {
					token: params['access_token']
				}
			})
			.done(function (data) {
				window.sessionStorage.idpAuth=data;
				goHome();
			});
		}
      }
    </script>
    <div id="main">Welcome Guest</div>
    <div id="action"><a href="javascript:login();">Login</a></div>
</body>
</html>
