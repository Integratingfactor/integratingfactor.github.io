<html>
	<head>
    <script src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <script src="md5.js"></script>

	</head>
  <body onload="checkTokenGrant()">
    <script language="javaScript">
      var clientId='test.endpoint.client';
      var clientSecret='';
      var clientAuth=md5(clientId+':'+clientSecret);
      var idpHost='http://localhost:8080'
      var idpLogin=idpHost+'/oauth/authorize?client_id='+clientId+'&response_type=token&redirect_uri='+'http://'+window.location.hostname+window.location.pathname;
      Element.prototype.remove = function() {
	    this.parentElement.removeChild(this);
 	  }
	  NodeList.prototype.remove = HTMLCollection.prototype.remove = function() {
	    for(var i = this.length - 1; i >= 0; i--) {
	        if(this[i] && this[i].parentElement) {
	            this[i].parentElement.removeChild(this[i]);
	        }
	    }
	  }
      function login(){
        window.location=idpLogin;
      }
      function logout(){
        window.location='http://'+window.location.hostname+window.location.pathname;
      }
      function checkTokenGrant() {
      	// First, parse the query string
		var params = {}, queryString = location.hash.substring(1),
		    regex = /([^&=]+)=([^&]*)/g, m;
		while (m = regex.exec(queryString)) {
		  params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
		}

		// Verify that we have a token grant
		if (params['access_token']) {
			console.log("using auth:", clientAuth);
			$.ajax({
				url:idpHost+'/oauth/check_token',
				type: "POST",
				headers: {
					Authorization: "Basic " + clientAuth
				},
				data: {
					token: params['access_token']
				}
			})
			.done(function (data) {
				console.log("data:", data);
			document.getElementById("main").textContent = "Welcome " + data['given_name'] + " " + data['family_name'];
			document.getElementById("login").remove();
			});
		} else {
			document.getElementById("main").textContent = "Welcome Guest";
			document.getElementById("logout").remove();
		}
      }
    </script>
    <div id="main"></div>
    <div id="login"><a href="javascript:login();">Login</a></div>
    <div id="logout"><a href="javascript:logout();">Logout</a></div>
</body>
</html>
